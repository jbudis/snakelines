rule qiime__taxa__barplot:
    """
    Create qiime barplot visualization of taxonomy data, calls 'qiime taxa barplot'
    :input rarefield_table: qiime artifact of type FeatureTable[Frequency], obtained from core-metrics-results, e.g. reads/qiime/joined-core-metrics-results/rarefied_table.qza
    :input taxonomy_qza: qiime artifact of type FeatureData[Taxonomy], e.g. reads/qiime/joined-taxonomy-dn-99.qza
    :input metadata: TSV metadata filepath, e.g. reads/qiime/joined-sample-metadata.tsv
    :output qzv: qiime visualization file, can be exported to HTML, e.g. reads/qiime/joined-taxa-barplots-dn-99.qzv
    """
    input:
        rarefield_table = 'reads/qiime/{name}-core-metrics-results/rarefied_table.qza',
        taxonomy_qza    = 'reads/qiime/{name}-taxonomy{file_suffix}.qza',
        metadata        = 'reads/qiime/{name}-sample-metadata.tsv'
    output:
        qzv             = 'reads/qiime/{name}-taxa-barplots{file_suffix}.qzv'
    shell:
        '''
        qiime taxa barplot \
            --i-table {input.rarefield_table} \
            --i-taxonomy {input.taxonomy_qza} \
            --m-metadata-file {input.metadata} \
            --o-visualization {output.qzv}
        '''
