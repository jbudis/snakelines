rule qiime__nonchimeric_wo_borderline:
    """
    Removes chimeras and 'borderline chimeras'.

    Calls 'qiime feature-table filter-features'.

    :input table: qiime artifact of type FeatureTable[Frequency], e.g. reads/qiime/joined-table-w-chimeras.qza
    :input rep_seqs: qiime artifact of type FeatureData[Sequence], e.g. reads/qiime/joined-rep-seqs-w-chimeras.qza
    :input nonchimeras: list of nonchimeric sequences, e.g. reads/qiime/joined-uchime-dn-out/nonchimeras.qza
    :output table: qiime artifact of type FeatureTable[Frequency] without chimeras and without borlerline chimeras, e.g. reads/qiime/joined-table.qza
    :output rep_seqs: qiime artifact of type FeatureData[Sequence] without chimeras and without borlerline chimeras, e.g. reads/qiime/joined-rep.qza
    """
    input:
        table       = 'reads/qiime/{name}-table-w-chimeras.qza',
        rep_seqs    = 'reads/qiime/{name}-rep-seqs-w-chimeras.qza',
        nonchimeras = 'reads/qiime/{name}-uchime-dn-out/nonchimeras.qza'
    output:
        table       = 'reads/qiime/{name}-table.qza',
        rep_seqs    = 'reads/qiime/{name}-rep-seqs.qza'
    shell:
        '''
            qiime feature-table filter-features \
              --i-table {input.table} \
              --m-metadata-file {input.nonchimeras} \
              --o-filtered-table {output.table}

            qiime feature-table filter-seqs \
              --i-data {input.rep_seqs} \
              --m-metadata-file {input.nonchimeras} \
              --o-filtered-data {output.rep_seqs}
        '''
