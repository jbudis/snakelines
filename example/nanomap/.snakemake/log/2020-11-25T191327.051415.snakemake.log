Building DAG of jobs...
Using shell: /bin/bash
Provided cores: 1 (use --cores to define parallelism)
Rules claiming more threads will be scaled down.
Job counts:
	count	jobs
	2	minimap2__map_reads_to_reference
	1	pipeline
	2	qualimap__mapping_quality_report_across_reference
	1	qualimap__summarize_quality_reports
	2	samtools__bam_index
	2	samtools__convert_sam_to_bam
	4	samtools__sort_bam_by_position
	14

[Wed Nov 25 19:13:27 2020]
rule minimap2__map_reads_to_reference:
    input: reads/original/example_1.fastq, reference/sars_cov_2/sars_cov_2.fa
    output: mapping/sars_cov_2/original/example_1.sam
    log: mapping/sars_cov_2/sorted/log/example_1.log, mapping/sars_cov_2/sorted/log/example_1.err
    jobid: 4
    reason: Missing output files: mapping/sars_cov_2/original/example_1.sam
    wildcards: reference=sars_cov_2, sample=example_1


            minimap2                 -ax map-ont                 reference/sars_cov_2/sars_cov_2.fa                 reads/original/example_1.fastq                 > mapping/sars_cov_2/original/example_1.sam
        
[Wed Nov 25 19:13:27 2020]
Finished job 4.
1 of 14 steps (7%) done

[Wed Nov 25 19:13:27 2020]
rule samtools__convert_sam_to_bam:
    input: mapping/sars_cov_2/original/example_1.sam
    output: mapping/sars_cov_2/original/example_1.bam
    jobid: 13
    reason: Missing output files: mapping/sars_cov_2/original/example_1.bam; Input files updated by another job: mapping/sars_cov_2/original/example_1.sam
    wildcards: path=mapping/sars_cov_2/original, sample=example_1


        samtools view -S -b mapping/sars_cov_2/original/example_1.sam > mapping/sars_cov_2/original/example_1.bam
        
[Wed Nov 25 19:13:27 2020]
Finished job 13.
2 of 14 steps (14%) done

[Wed Nov 25 19:13:27 2020]
rule minimap2__map_reads_to_reference:
    input: reads/original/example_2.fastq, reference/sars_cov_2/sars_cov_2.fa
    output: mapping/sars_cov_2/original/example_2.sam
    log: mapping/sars_cov_2/sorted/log/example_2.log, mapping/sars_cov_2/sorted/log/example_2.err
    jobid: 5
    reason: Missing output files: mapping/sars_cov_2/original/example_2.sam
    wildcards: reference=sars_cov_2, sample=example_2


            minimap2                 -ax map-ont                 reference/sars_cov_2/sars_cov_2.fa                 reads/original/example_2.fastq                 > mapping/sars_cov_2/original/example_2.sam
        
[Wed Nov 25 19:13:28 2020]
Finished job 5.
3 of 14 steps (21%) done

[Wed Nov 25 19:13:28 2020]
rule samtools__convert_sam_to_bam:
    input: mapping/sars_cov_2/original/example_2.sam
    output: mapping/sars_cov_2/original/example_2.bam
    jobid: 15
    reason: Missing output files: mapping/sars_cov_2/original/example_2.bam; Input files updated by another job: mapping/sars_cov_2/original/example_2.sam
    wildcards: path=mapping/sars_cov_2/original, sample=example_2


        samtools view -S -b mapping/sars_cov_2/original/example_2.sam > mapping/sars_cov_2/original/example_2.bam
        
[Wed Nov 25 19:13:28 2020]
Finished job 15.
4 of 14 steps (29%) done

[Wed Nov 25 19:13:28 2020]
rule samtools__sort_bam_by_position:
    input: mapping/sars_cov_2/original/example_1.bam
    output: mapping/sars_cov_2/original/example_1_sorted.bam
    jobid: 9
    reason: Missing output files: mapping/sars_cov_2/original/example_1_sorted.bam; Input files updated by another job: mapping/sars_cov_2/original/example_1.bam
    wildcards: path=mapping/sars_cov_2/original, sample=example_1


        samtools sort mapping/sars_cov_2/original/example_1.bam > mapping/sars_cov_2/original/example_1_sorted.bam
        
[Wed Nov 25 19:13:28 2020]
Finished job 9.
5 of 14 steps (36%) done

[Wed Nov 25 19:13:28 2020]
rule samtools__sort_bam_by_position:
    input: mapping/sars_cov_2/original/example_1_sorted.bam
    output: mapping/sars_cov_2/original/example_1_sorted_sorted.bam
    jobid: 14
    reason: Missing output files: mapping/sars_cov_2/original/example_1_sorted_sorted.bam; Input files updated by another job: mapping/sars_cov_2/original/example_1_sorted.bam
    wildcards: path=mapping/sars_cov_2/original, sample=example_1_sorted


        samtools sort mapping/sars_cov_2/original/example_1_sorted.bam > mapping/sars_cov_2/original/example_1_sorted_sorted.bam
        
[Wed Nov 25 19:13:28 2020]
Finished job 14.
6 of 14 steps (43%) done

[Wed Nov 25 19:13:28 2020]
rule samtools__bam_index:
    input: mapping/sars_cov_2/original/example_1_sorted_sorted.bam
    output: mapping/sars_cov_2/original/example_1_sorted.bam.bai
    jobid: 10
    reason: Missing output files: mapping/sars_cov_2/original/example_1_sorted.bam.bai; Input files updated by another job: mapping/sars_cov_2/original/example_1_sorted_sorted.bam
    wildcards: path=mapping/sars_cov_2/original, sample=example_1_sorted


        samtools index mapping/sars_cov_2/original/example_1_sorted_sorted.bam > mapping/sars_cov_2/original/example_1_sorted.bam.bai
        
[Wed Nov 25 19:13:28 2020]
Finished job 10.
7 of 14 steps (50%) done

[Wed Nov 25 19:13:28 2020]
rule qualimap__mapping_quality_report_across_reference:
    input: mapping/sars_cov_2/original/example_1_sorted.bam, mapping/sars_cov_2/original/example_1_sorted.bam.bai
    output: mapping/sars_cov_2/original/stats-wgs/samples/example_1/qualimapReport.html, mapping/sars_cov_2/original/stats-wgs/samples/example_1/report.pdf, mapping/sars_cov_2/original/stats-wgs/samples/example_1/genome_results.txt
    log: mapping/sars_cov_2/original/stats-wgs/samples/example_1/log/analysis.log, mapping/sars_cov_2/original/stats-wgs/samples/example_1/log/analysis.err
    jobid: 6
    reason: Missing output files: mapping/sars_cov_2/original/stats-wgs/samples/example_1/report.pdf; Input files updated by another job: mapping/sars_cov_2/original/example_1_sorted.bam.bai, mapping/sars_cov_2/original/example_1_sorted.bam
    wildcards: bamdir=mapping/sars_cov_2/original, sample=example_1


        unset DISPLAY
        qualimap bamqc             --java-mem-size=1G             -bam mapping/sars_cov_2/original/example_1_sorted.bam             --paint-chromosome-limits             -outdir mapping/sars_cov_2/original/stats-wgs/samples/example_1             -outformat PDF:HTML             -nt 1         >  mapping/sars_cov_2/original/stats-wgs/samples/example_1/log/analysis.log         2> mapping/sars_cov_2/original/stats-wgs/samples/example_1/log/analysis.err
        
[Wed Nov 25 19:13:32 2020]
Finished job 6.
8 of 14 steps (57%) done

[Wed Nov 25 19:13:32 2020]
rule samtools__sort_bam_by_position:
    input: mapping/sars_cov_2/original/example_2.bam
    output: mapping/sars_cov_2/original/example_2_sorted.bam
    jobid: 11
    reason: Missing output files: mapping/sars_cov_2/original/example_2_sorted.bam; Input files updated by another job: mapping/sars_cov_2/original/example_2.bam
    wildcards: path=mapping/sars_cov_2/original, sample=example_2


        samtools sort mapping/sars_cov_2/original/example_2.bam > mapping/sars_cov_2/original/example_2_sorted.bam
        
[Wed Nov 25 19:13:32 2020]
Finished job 11.
9 of 14 steps (64%) done

[Wed Nov 25 19:13:32 2020]
rule samtools__sort_bam_by_position:
    input: mapping/sars_cov_2/original/example_2_sorted.bam
    output: mapping/sars_cov_2/original/example_2_sorted_sorted.bam
    jobid: 16
    reason: Missing output files: mapping/sars_cov_2/original/example_2_sorted_sorted.bam; Input files updated by another job: mapping/sars_cov_2/original/example_2_sorted.bam
    wildcards: path=mapping/sars_cov_2/original, sample=example_2_sorted


        samtools sort mapping/sars_cov_2/original/example_2_sorted.bam > mapping/sars_cov_2/original/example_2_sorted_sorted.bam
        
[Wed Nov 25 19:13:32 2020]
Finished job 16.
10 of 14 steps (71%) done

[Wed Nov 25 19:13:32 2020]
rule samtools__bam_index:
    input: mapping/sars_cov_2/original/example_2_sorted_sorted.bam
    output: mapping/sars_cov_2/original/example_2_sorted.bam.bai
    jobid: 12
    reason: Missing output files: mapping/sars_cov_2/original/example_2_sorted.bam.bai; Input files updated by another job: mapping/sars_cov_2/original/example_2_sorted_sorted.bam
    wildcards: path=mapping/sars_cov_2/original, sample=example_2_sorted


        samtools index mapping/sars_cov_2/original/example_2_sorted_sorted.bam > mapping/sars_cov_2/original/example_2_sorted.bam.bai
        
[Wed Nov 25 19:13:32 2020]
Finished job 12.
11 of 14 steps (79%) done

[Wed Nov 25 19:13:32 2020]
rule qualimap__mapping_quality_report_across_reference:
    input: mapping/sars_cov_2/original/example_2_sorted.bam, mapping/sars_cov_2/original/example_2_sorted.bam.bai
    output: mapping/sars_cov_2/original/stats-wgs/samples/example_2/qualimapReport.html, mapping/sars_cov_2/original/stats-wgs/samples/example_2/report.pdf, mapping/sars_cov_2/original/stats-wgs/samples/example_2/genome_results.txt
    log: mapping/sars_cov_2/original/stats-wgs/samples/example_2/log/analysis.log, mapping/sars_cov_2/original/stats-wgs/samples/example_2/log/analysis.err
    jobid: 7
    reason: Missing output files: mapping/sars_cov_2/original/stats-wgs/samples/example_2/report.pdf; Input files updated by another job: mapping/sars_cov_2/original/example_2_sorted.bam.bai, mapping/sars_cov_2/original/example_2_sorted.bam
    wildcards: bamdir=mapping/sars_cov_2/original, sample=example_2


        unset DISPLAY
        qualimap bamqc             --java-mem-size=1G             -bam mapping/sars_cov_2/original/example_2_sorted.bam             --paint-chromosome-limits             -outdir mapping/sars_cov_2/original/stats-wgs/samples/example_2             -outformat PDF:HTML             -nt 1         >  mapping/sars_cov_2/original/stats-wgs/samples/example_2/log/analysis.log         2> mapping/sars_cov_2/original/stats-wgs/samples/example_2/log/analysis.err
        
[Wed Nov 25 19:13:35 2020]
Finished job 7.
12 of 14 steps (86%) done

[Wed Nov 25 19:13:35 2020]
rule qualimap__summarize_quality_reports:
    input: mapping/sars_cov_2/original/stats-wgs/samples/example_1/report.pdf, mapping/sars_cov_2/original/stats-wgs/samples/example_2/report.pdf
    output: mapping/sars_cov_2/original/stats-wgs/summary/multisampleBamQcReport.html, mapping/sars_cov_2/original/stats-wgs/summary/report.pdf
    log: mapping/sars_cov_2/original/stats-wgs/summary/log/analysis.log, mapping/sars_cov_2/original/stats-wgs/summary/log/analysis.err
    jobid: 8
    reason: Missing output files: mapping/sars_cov_2/original/stats-wgs/summary/report.pdf; Input files updated by another job: mapping/sars_cov_2/original/stats-wgs/samples/example_1/report.pdf, mapping/sars_cov_2/original/stats-wgs/samples/example_2/report.pdf
    wildcards: mapper=mapping, reference=sars_cov_2, map_type=original, panel=wgs


        unset DISPLAY
        # Prepare sample list file for the qualimap
        ## Column1: Sample name
        ## Column2: Path to precomputed bamqc report

        for REPORT in mapping/sars_cov_2/original/stats-wgs/samples/example_1/report.pdf mapping/sars_cov_2/original/stats-wgs/samples/example_2/report.pdf; do
            REPORT_DIR=`dirname $REPORT`
            SAMPLE=`basename $REPORT_DIR`
            echo -e "$SAMPLE	$REPORT_DIR" >> mapping/sars_cov_2/original/stats-wgs/summary/samples.list
        done

        # Run qualimap on samples specified in sample list
        qualimap multi-bamqc             -d mapping/sars_cov_2/original/stats-wgs/summary/samples.list             -outdir mapping/sars_cov_2/original/stats-wgs/summary             -outformat PDF:HTML         >  mapping/sars_cov_2/original/stats-wgs/summary/log/analysis.log         2> mapping/sars_cov_2/original/stats-wgs/summary/log/analysis.err
        
[Wed Nov 25 19:13:37 2020]
Finished job 8.
13 of 14 steps (93%) done

[Wed Nov 25 19:13:37 2020]
localrule pipeline:
    input: reads/original/stats/example_1_fastqc.html, reads/original/stats/example_2_fastqc.html, reads/original/stats/summary.html, mapping/sars_cov_2/original/example_1.sam, mapping/sars_cov_2/original/example_2.sam, mapping/sars_cov_2/original/stats-wgs/samples/example_1/report.pdf, mapping/sars_cov_2/original/stats-wgs/samples/example_2/report.pdf, mapping/sars_cov_2/original/stats-wgs/summary/report.pdf
    jobid: 0
    reason: Input files updated by another job: mapping/sars_cov_2/original/stats-wgs/samples/example_2/report.pdf, mapping/sars_cov_2/original/example_1.sam, mapping/sars_cov_2/original/example_2.sam, mapping/sars_cov_2/original/stats-wgs/summary/report.pdf, mapping/sars_cov_2/original/stats-wgs/samples/example_1/report.pdf

[Wed Nov 25 19:13:37 2020]
Finished job 0.
14 of 14 steps (100%) done
Complete log: /home/adog/snakelines/example/nanomap/.snakemake/log/2020-11-25T191327.051415.snakemake.log
